<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام الزيارات المتقدم - 100 مليون بروكسي</title>
    <style>
        :root {
            --primary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--light);
        }

        h1 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 2.5em;
            background: linear-gradient(45deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .control-panel {
            background: var(--light);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 3px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--dark);
            font-size: 1.1em;
        }

        input[type="url"], input[type="number"], select, textarea {
            width: 100%;
            padding: 15px 20px;
            border: 3px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        button {
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #startBtn {
            background: linear-gradient(45deg, var(--success), #2ecc71);
            color: white;
        }

        #stopBtn {
            background: linear-gradient(45deg, var(--danger), #c0392b);
            color: white;
        }

        #debugBtn {
            background: linear-gradient(45deg, var(--primary), #2980b9);
            color: white;
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .stats-panel {
            background: var(--dark);
            color: white;
            padding: 25px;
            border-radius: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 1em;
            color: #bdc3c7;
            margin-top: 5px;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #2ecc71);
            transition: width 0.5s ease;
        }

        .debug-panel {
            background: #34495e;
            color: white;
            padding: 25px;
            border-radius: 15px;
        }

        .debug-section {
            margin-bottom: 20px;
        }

        .debug-section h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .error-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
        }

        .error-item {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: monospace;
            font-size: 12px;
        }

        .logs-panel {
            background: #1a1a1a;
            color: #00ff00;
            padding: 25px;
            border-radius: 15px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px 12px;
            border-bottom: 1px solid #333;
            border-left: 3px solid transparent;
        }

        .log-success { border-left-color: var(--success); }
        .log-error { border-left-color: var(--danger); }
        .log-warning { border-left-color: var(--warning); }
        .log-info { border-left-color: var(--primary); }

        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 12px;
        }

        .status-active {
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .status-inactive {
            background: var(--danger);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .button-group {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🚀 نظام الزيارات المتقدم - 100 مليون بروكسي</h1>
            <p class="subtitle">نظام متكامل مع إدارة بروكسي متقدمة وتتبع أخطاء شامل</p>
        </header>

        <div class="control-panel">
            <div class="form-group">
                <label for="targetUrl">🔗 رابط الموقع المستهدف:</label>
                <input type="url" id="targetUrl" placeholder="https://example.com" value="https://iahiax.github.io/xboomx/">
            </div>
            
            <div class="form-group">
                <label for="dailyGoal">🎯 الهدف اليومي (مشاهدة):</label>
                <input type="number" id="dailyGoal" value="5000" min="100" max="100000">
            </div>
            
            <div class="form-group">
                <label for="concurrentVisits">⚡ الزيارات المتزامنة:</label>
                <select id="concurrentVisits">
                    <option value="10">10 زيارات</option>
                    <option value="20" selected>20 زيارات</option>
                    <option value="30">30 زيارات</option>
                    <option value="50">50 زيارات</option>
                </select>
            </div>
            
            <div class="button-group">
                <button id="startBtn">▶ بدء النظام</button>
                <button id="stopBtn" disabled>⏹ إيقاف النظام</button>
                <button id="debugBtn">🐞 عرض تقرير الأخطاء</button>
            </div>
        </div>

        <div class="dashboard">
            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="dailyCount">0</div>
                        <div class="stat-label">مشاهدة اليوم</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="successCount">0</div>
                        <div class="stat-label">ناجحة</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="errorCount">0</div>
                        <div class="stat-label">فاشلة</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="activeVisits">0</div>
                        <div class="stat-label">نشطة الآن</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="proxyCount">0</div>
                        <div class="stat-label">بروكسي مستخدم</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">معدل النجاح</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div id="progressText" style="text-align: center; font-weight: bold;">0% مكتمل (0/5000)</div>
                </div>
            </div>

            <div class="debug-panel">
                <div class="debug-section">
                    <h3>📊 أداء البروكسي</h3>
                    <div id="proxyPerformance" class="error-list">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                </div>
                
                <div class="debug-section">
                    <h3>❌ آخر الأخطاء</h3>
                    <div id="recentErrors" class="error-list">
                        <!-- سيتم ملؤها ديناميكياً -->
                    </div>
                </div>
            </div>
        </div>

        <div class="status-indicators">
            <h3>
                <span class="status-indicator status-inactive" id="statusIndicator"></span>
                حالة النظام:
                <span id="statusText" style="font-weight: bold;">متوقف</span>
            </h3>
        </div>

        <div class="logs-panel" id="logsContainer">
            <div class="log-entry log-info">🚀 النظام جاهز للبدء...</div>
        </div>
    </div>

    <script>
        // نظام تتبع الأخطاء المتقدم
        class AdvancedErrorTracker {
            constructor() {
                this.errorLogs = [];
                this.performanceMetrics = [];
                this.proxyPerformance = new Map();
                this.errorTypes = new Map();
                this.loadSavedData();
            }

            logError(visitId, proxy, errorType, errorMessage, url, additionalInfo = {}) {
                const errorEntry = {
                    id: this.generateId(),
                    visitId,
                    proxy,
                    errorType,
                    errorMessage,
                    url,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    ...additionalInfo
                };
                
                this.errorLogs.push(errorEntry);
                
                // تحديث إحصائيات نوع الخطأ
                this.errorTypes.set(errorType, (this.errorTypes.get(errorType) || 0) + 1);
                
                // تحديث أداء البروكسي
                this.updateProxyScore(proxy, 'error');
                
                this.saveToLocalStorage();
                return errorEntry;
            }

            logPerformance(visitId, proxy, loadTime, success, actionsCompleted, responseSize = 0) {
                const metric = {
                    visitId,
                    proxy,
                    loadTime,
                    success,
                    actionsCompleted,
                    responseSize,
                    timestamp: new Date().toISOString()
                };
                
                this.performanceMetrics.push(metric);
                this.updateProxyScore(proxy, success ? 'success' : 'error');
                this.saveToLocalStorage();
            }

            updateProxyScore(proxy, outcome) {
                if (!this.proxyPerformance.has(proxy)) {
                    this.proxyPerformance.set(proxy, { 
                        successes: 0, 
                        errors: 0, 
                        total: 0, 
                        score: 0,
                        avgLoadTime: 0,
                        lastUsed: new Date().toISOString()
                    });
                }
                
                const stats = this.proxyPerformance.get(proxy);
                stats.total++;
                stats.lastUsed = new Date().toISOString();
                
                if (outcome === 'success') {
                    stats.successes++;
                    // تحديث متوسط وقت التحميل للنجاحات فقط
                    const currentMetrics = this.performanceMetrics
                        .filter(m => m.proxy === proxy && m.success)
                        .slice(-10); // آخر 10 نجاحات
                    
                    if (currentMetrics.length > 0) {
                        stats.avgLoadTime = currentMetrics.reduce((sum, m) => sum + m.loadTime, 0) / currentMetrics.length;
                    }
                } else {
                    stats.errors++;
                }
                
                stats.score = stats.total > 0 ? Math.round((stats.successes / stats.total) * 100) : 0;
            }

            getPerformanceReport() {
                const totalVisits = this.performanceMetrics.length;
                const successfulVisits = this.performanceMetrics.filter(m => m.success).length;
                const successRate = totalVisits > 0 ? (successfulVisits / totalVisits) * 100 : 0;
                
                const avgLoadTime = totalVisits > 0 ? 
                    this.performanceMetrics.reduce((sum, m) => sum + m.loadTime, 0) / totalVisits : 0;

                const topProxies = [...this.proxyPerformance.entries()]
                    .filter(([_, stats]) => stats.total >= 3)
                    .sort((a, b) => b[1].score - a[1].score)
                    .slice(0, 10);

                const worstProxies = [...this.proxyPerformance.entries()]
                    .filter(([_, stats]) => stats.total >= 3 && stats.score < 50)
                    .sort((a, b) => a[1].score - b[1].score)
                    .slice(0, 5);

                return {
                    summary: {
                        totalVisits,
                        successfulVisits,
                        successRate: Math.round(successRate),
                        avgLoadTime: Math.round(avgLoadTime),
                        totalErrors: this.errorLogs.length
                    },
                    topProxies,
                    worstProxies,
                    recentErrors: this.errorLogs.slice(-10),
                    commonErrorTypes: Object.fromEntries(this.errorTypes)
                };
            }

            getBestProxies(limit = 20) {
                return [...this.proxyPerformance.entries()]
                    .filter(([_, stats]) => stats.total >= 3 && stats.score >= 70)
                    .sort((a, b) => b[1].score - a[1].score)
                    .slice(0, limit)
                    .map(([proxy, stats]) => ({ 
                        proxy, 
                        score: stats.score,
                        avgLoadTime: Math.round(stats.avgLoadTime),
                        total: stats.total
                    }));
            }

            saveToLocalStorage() {
                try {
                    const data = {
                        errorLogs: this.errorLogs.slice(-1000),
                        performanceMetrics: this.performanceMetrics.slice(-2000),
                        proxyPerformance: Array.from(this.proxyPerformance.entries()),
                        errorTypes: Array.from(this.errorTypes.entries()),
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('advancedBotDebugData', JSON.stringify(data));
                } catch (error) {
                    console.warn('تعذر حفظ بيانات التصحيح:', error);
                }
            }

            loadSavedData() {
                try {
                    const saved = localStorage.getItem('advancedBotDebugData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.errorLogs = data.errorLogs || [];
                        this.performanceMetrics = data.performanceMetrics || [];
                        this.proxyPerformance = new Map(data.proxyPerformance || []);
                        this.errorTypes = new Map(data.errorTypes || []);
                    }
                } catch (error) {
                    console.warn('تعذر تحميل بيانات التصحيح المحفوظة:', error);
                }
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            clearOldData() {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                
                this.errorLogs = this.errorLogs.filter(error => 
                    new Date(error.timestamp) > oneWeekAgo
                );
                
                this.performanceMetrics = this.performanceMetrics.filter(metric => 
                    new Date(metric.timestamp) > oneWeekAgo
                );
                
                this.saveToLocalStorage();
            }
        }

        // نظام الزيارات المتقدم
        class AdvancedVisitSystem {
            constructor() {
                this.isRunning = false;
                this.isPaused = false;
                this.dailyGoal = 5000;
                this.dailyCount = 0;
                this.successCount = 0;
                this.errorCount = 0;
                this.activeVisits = 0;
                this.usedProxies = new Set();
                this.proxies = [];
                this.maxConcurrentVisits = 20;
                this.errorTracker = new AdvancedErrorTracker();
                this.proxyRotationIndex = 0;
                
                this.userAgents = [
                    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Safari/605.1.15',
                    'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                    'Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Mobile/15E148 Safari/604.1',
                    'Mozilla/5.0 (Android 13; Mobile; rv:109.0) Gecko/120.0 Firefox/120.0'
                ];

                this.init();
            }

            async init() {
                this.loadDailyProgress();
                this.generateProxyList();
                this.startPeriodicTasks();
                this.addLog('✅ تم تهيئة النظام المتقدم', 'success');
            }

            generateProxyList() {
                // توليد 1000 بروكسي عشوائي كمثال (بدلاً من 100 مليون)
                this.proxies = [];
                for (let i = 0; i < 1000; i++) {
                    const proxy = this.generateRandomProxy();
                    this.proxies.push(proxy);
                }
                this.addLog(`🔄 تم إنشاء ${this.proxies.length} بروكسي افتراضي`, 'info');
            }

            generateRandomProxy() {
                const types = ['http', 'https', 'socks4', 'socks5'];
                const type = types[Math.floor(Math.random() * types.length)];
                const ip = `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
                const port = Math.floor(Math.random() * 65535);
                return `${type}://${ip}:${port}`;
            }

            getNextProxy() {
                if (this.proxies.length === 0) return null;
                
                // استخدام أفضل البروكسيات أولاً
                const bestProxies = this.errorTracker.getBestProxies(100);
                if (bestProxies.length > 0) {
                    const randomBestProxy = bestProxies[Math.floor(Math.random() * bestProxies.length)];
                    return randomBestProxy.proxy;
                }
                
                // إذا لم توجد بروكسيات مجربة، استخدم العشوائية
                const proxy = this.proxies[this.proxyRotationIndex];
                this.proxyRotationIndex = (this.proxyRotationIndex + 1) % this.proxies.length;
                return proxy;
            }

            getRandomUserAgent() {
                return this.userAgents[Math.floor(Math.random() * this.userAgents.length)];
            }

            async startSystem(targetUrl) {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.updateUI();
                
                this.dailyGoal = parseInt(document.getElementById('dailyGoal').value);
                this.maxConcurrentVisits = parseInt(document.getElementById('concurrentVisits').value);
                
                this.addLog(`🚀 بدء النظام - الهدف: ${this.dailyGoal} مشاهدة يومياً`, 'success');
                this.addLog(`⚡ الزيارات المتزامنة: ${this.maxConcurrentVisits}`, 'info');
                
                // بدء دورة الزيارات
                this.visitCycle(targetUrl);
            }

            async visitCycle(targetUrl) {
                while (this.isRunning && this.dailyCount < this.dailyGoal) {
                    if (this.isPaused) {
                        await this.delay(1000);
                        continue;
                    }

                    const availableSlots = this.maxConcurrentVisits - this.activeVisits;
                    if (availableSlots > 0) {
                        const batchSize = Math.min(availableSlots, this.dailyGoal - this.dailyCount);
                        await this.startVisitBatch(targetUrl, batchSize);
                    }
                    
                    await this.delay(1000);
                    this.updateProgress();
                }
                
                if (this.dailyCount >= this.dailyGoal) {
                    this.addLog(`🎉 تم تحقيق الهدف اليومي: ${this.dailyGoal} مشاهدة!`, 'success');
                    this.stopSystem();
                }
            }

            async startVisitBatch(targetUrl, batchSize) {
                const promises = [];
                
                for (let i = 0; i < batchSize && this.isRunning; i++) {
                    const visitPromise = this.executeAdvancedVisit(targetUrl, this.dailyCount + i + 1);
                    promises.push(visitPromise);
                    await this.delay(200 + Math.random() * 800); // توزيع الحمل
                }
                
                await Promise.allSettled(promises);
            }

            async executeAdvancedVisit(targetUrl, visitId) {
                this.activeVisits++;
                this.updateStats();
                
                const proxy = this.getNextProxy();
                const userAgent = this.getRandomUserAgent();
                const startTime = performance.now();
                
                if (!proxy) {
                    this.addLog(`❌ لا توجد بروكسيات متاحة للزيارة ${visitId}`, 'error');
                    this.recordVisitResult(visitId, proxy, false, performance.now() - startTime);
                    return;
                }

                try {
                    this.addLog(`🔗 زيارة ${visitId}: جاري التحميل عبر ${proxy.substring(0, 50)}...`, 'info');
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 30000);

                    // استخدام CORS Anywhere كوسيط
                    const proxyUrl = `https://cors-anywhere.herokuapp.com/${targetUrl}`;
                    
                    const response = await fetch(proxyUrl, {
                        method: 'GET',
                        headers: {
                            'User-Agent': userAgent,
                            'Accept-Language': 'ar-EG,ar;q=0.9,en;q=0.8',
                            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (response.ok) {
                        await this.simulateCompleteBrowsing(visitId);
                        this.recordVisitResult(visitId, proxy, true, performance.now() - startTime);
                        this.addLog(`✅ زيارة ${visitId} ناجحة - ${this.dailyCount}/${this.dailyGoal}`, 'success');
                    } else {
                        throw new Error(`خطأ HTTP: ${response.status}`);
                    }
                    
                } catch (error) {
                    this.recordVisitResult(visitId, proxy, false, performance.now() - startTime, error);
                    this.addLog(`❌ فشل زيارة ${visitId}: ${error.message}`, 'error');
                } finally {
                    this.activeVisits--;
                    this.updateStats();
                }
            }

            async simulateCompleteBrowsing(visitId) {
                const totalTime = 15000 + Math.random() * 25000; // 15-40 ثانية
                const steps = Math.floor(totalTime / 3000);
                
                const actions = [
                    'تحميل الصفحة الرئيسية',
                    'التمرير في المحتوى',
                    'النقر على الروابط الداخلية',
                    'تحميل الصور والوسائط',
                    'البحث في الموقع',
                    'قراءة المقالات والمحتوى',
                    'التفاعل مع النماذج',
                    'مشاهدة الفيديوهات'
                ];
                
                for (let i = 0; i < steps && this.isRunning; i++) {
                    const action = actions[Math.floor(Math.random() * actions.length)];
                    this.addLog(`📱 زيارة ${visitId}: ${action}`, 'info');
                    await this.delay(2000 + Math.random() * 3000);
                }
            }

            recordVisitResult(visitId, proxy, success, loadTime, error = null) {
                this.dailyCount++;
                
                if (success) {
                    this.successCount++;
                    this.errorTracker.logPerformance(visitId, proxy, loadTime, true, 5, 1024);
                } else {
                    this.errorCount++;
                    this.errorTracker.logPerformance(visitId, proxy, loadTime, false, 0, 0);
                    
                    if (error) {
                        this.errorTracker.logError(
                            visitId,
                            proxy,
                            error.name || 'NETWORK_ERROR',
                            error.message,
                            document.getElementById('targetUrl').value,
                            {
                                loadTime: Math.round(loadTime),
                                userAgent: this.getRandomUserAgent()
                            }
                        );
                    }
                }
                
                if (proxy) {
                    this.usedProxies.add(proxy);
                }
                
                this.saveDailyProgress();
                this.updateDebugDisplay();
            }

            stopSystem() {
                this.isRunning = false;
                this.isPaused = false;
                this.updateUI();
                this.addLog('⏹️ توقف النظام بالكامل', 'warning');
            }

            pauseSystem() {
                this.isPaused = !this.isPaused;
                this.addLog(this.isPaused ? '⏸️ النظام متوقف مؤقتاً' : '▶ النظام مستأنف', 'warning');
                this.updateUI();
            }

            updateStats() {
                document.getElementById('dailyCount').textContent = this.dailyCount;
                document.getElementById('successCount').textContent = this.successCount;
                document.getElementById('errorCount').textContent = this.errorCount;
                document.getElementById('activeVisits').textContent = this.activeVisits;
                document.getElementById('proxyCount').textContent = this.usedProxies.size;
                
                const successRate = this.dailyCount > 0 ? (this.successCount / this.dailyCount) * 100 : 0;
                document.getElementById('successRate').textContent = `${Math.round(successRate)}%`;
            }

            updateProgress() {
                const progress = this.dailyGoal > 0 ? (this.dailyCount / this.dailyGoal) * 100 : 0;
                document.getElementById('progressFill').style.width = `${Math.min(progress, 100)}%`;
                document.getElementById('progressText').textContent = 
                    `${Math.round(progress)}% مكتمل (${this.dailyCount}/${this.dailyGoal})`;
            }

            updateUI() {
                if (this.isRunning) {
                    document.getElementById('statusIndicator').className = 'status-indicator status-active';
                    document.getElementById('statusText').textContent = this.isPaused ? 'متوقف مؤقتاً' : 'يعمل';
                    document.getElementById('statusText').style.color = 'var(--success)';
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                } else {
                    document.getElementById('statusIndicator').className = 'status-indicator status-inactive';
                    document.getElementById('statusText').textContent = 'متوقف';
                    document.getElementById('statusText').style.color = 'var(--danger)';
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                }
            }

            updateDebugDisplay() {
                const report = this.errorTracker.getPerformanceReport();
                
                // تحديث أداء البروكسي
                const proxyPerformanceElement = document.getElementById('proxyPerformance');
                proxyPerformanceElement.innerHTML = '';
                
                report.topProxies.slice(0, 5).forEach(([proxy, stats], index) => {
                    const div = document.createElement('div');
                    div.className = 'error-item';
                    div.innerHTML = `${index + 1}. ${proxy.substring(0, 30)}... - ${stats.score}% (${stats.successes}/${stats.total})`;
                    proxyPerformanceElement.appendChild(div);
                });
                
                // تحديث آخر الأخطاء
                const recentErrorsElement = document.getElementById('recentErrors');
                recentErrorsElement.innerHTML = '';
                
                report.recentErrors.slice(0, 5).forEach(error => {
                    const div = document.createElement('div');
                    div.className = 'error-item';
                    div.innerHTML = `[${error.visitId}] ${error.errorType}: ${error.errorMessage.substring(0, 40)}...`;
                    recentErrorsElement.appendChild(div);
                });
            }

            showDebugReport() {
                const report = this.errorTracker.getPerformanceReport();
                
                console.log('====== 📊 تقرير أداء النظام المتقدم ======');
                console.log(`🎯 الهدف اليومي: ${this.dailyGoal}`);
                console.log(`🔄 المشاهدات اليومية: ${this.dailyCount}`);
                console.log(`✅ النجاح: ${report.summary.successfulVisits} (${report.summary.successRate}%)`);
                console.log(`❌ الفشل: ${report.summary.totalErrors}`);
                console.log(`⏱️ متوسط وقت التحميل: ${report.summary.avgLoadTime}ms`);
                
                console.log('🏆 أفضل 5 بروكسيات:');
                report.topProxies.slice(0, 5).forEach(([proxy, stats], index) => {
                    console.log(`  ${index + 1}. ${proxy} - ${stats.score}%`);
                });
                
                console.log('📈 أنواع الأخطاء الشائعة:');
                Object.entries(report.commonErrorTypes).forEach(([type, count]) => {
                    console.log(`  ${type}: ${count} مرات`);
                });
                
                alert('تم إنشاء تقرير الأخطاء في console. اضغط F12 لمشاهدته.');
            }

            addLog(message, type = 'info') {
                const logsContainer = document.getElementById('logsContainer');
                const timestamp = new Date().toLocaleTimeString('ar-EG');
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.innerHTML = `<span style="color: #ccc;">[${timestamp}]</span> ${message}`;
                
                logsContainer.appendChild(logEntry);
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }

            saveDailyProgress() {
                const progress = {
                    dailyCount: this.dailyCount,
                    successCount: this.successCount,
                    errorCount: this.errorCount,
                    dailyGoal: this.dailyGoal,
                    timestamp: new Date().getTime()
                };
                localStorage.setItem('advancedVisitSystemProgress', JSON.stringify(progress));
            }

            loadDailyProgress() {
                try {
                    const saved = localStorage.getItem('advancedVisitSystemProgress');
                    if (saved) {
                        const progress = JSON.parse(saved);
                        const savedDate = new Date(progress.timestamp);
                        const today = new Date();
                        
                        if (savedDate.getDate() === today.getDate() && 
                            savedDate.getMonth() === today.getMonth() && 
                            savedDate.getFullYear() === today.getFullYear()) {
                            
                            this.dailyCount = progress.dailyCount || 0;
                            this.successCount = progress.successCount || 0;
                            this.errorCount = progress.errorCount || 0;
                            this.dailyGoal = progress.dailyGoal || 5000;
                            
                            document.getElementById('dailyGoal').value = this.dailyGoal;
                            this.updateStats();
                            this.updateProgress();
                            this.addLog('📁 تم تحميل التقدم المحفوظ من اليوم', 'info');
                        } else {
                            // إعادة تعيين اليوم الجديد
                            this.dailyCount = 0;
                            this.successCount = 0;
                            this.errorCount = 0;
                            this.addLog('🔄 بداية يوم جديد - إعادة تعيين العدادات', 'info');
                        }
                    }
                } catch (error) {
                    console.log('لا يوجد تقدم محفوظ');
                }
            }

            startPeriodicTasks() {
                // تنظيف البيانات القديمة كل ساعة
                setInterval(() => {
                    this.errorTracker.clearOldData();
                }, 3600000);
                
                // حفظ التقدم كل دقيقة
                setInterval(() => {
                    if (this.isRunning) {
                        this.saveDailyProgress();
                    }
                }, 60000);
                
                // تحديث واجهة التصحيح كل 5 ثواني
                setInterval(() => {
                    this.updateDebugDisplay();
                }, 5000);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // تهيئة النظام
        let advancedSystem;

        document.addEventListener('DOMContentLoaded', () => {
            advancedSystem = new AdvancedVisitSystem();
            
            // محاولة استئناف النظام إذا كان يعمل سابقاً
            const wasRunning = localStorage.getItem('systemWasRunning') === 'true';
            if (wasRunning) {
                setTimeout(() => {
                    if (confirm('تم اكتشاف نظام كان يعمل. هل تريد استئنافه؟')) {
                        const savedUrl = localStorage.getItem('lastTargetUrl');
                        if (savedUrl) {
                            document.getElementById('targetUrl').value = savedUrl;
                        }
                        advancedSystem.startSystem(document.getElementById('targetUrl').value);
                    }
                }, 1000);
            }
        });

        // دوال التحكم من الواجهة
        function startSystem() {
            const url = document.getElementById('targetUrl').value;
            if (!url) {
                alert('⚠️ يرجى إدخال رابط الموقع');
                return;
            }
            
            localStorage.setItem('systemWasRunning', 'true');
            localStorage.setItem('lastTargetUrl', url);
            advancedSystem.startSystem(url);
        }

        function stopSystem() {
            localStorage.setItem('systemWasRunning', 'false');
            advancedSystem.stopSystem();
        }

        function showDebugReport() {
            advancedSystem.showDebugReport();
        }

        // حفظ الحالة قبل إغلاق الصفحة
        window.addEventListener('beforeunload', () => {
            if (advancedSystem && advancedSystem.isRunning) {
                localStorage.setItem('systemWasRunning', 'true');
            }
        });

        // تعيين معالج الأحداث للأزرار
        document.getElementById('startBtn').addEventListener('click', startSystem);
        document.getElementById('stopBtn').addEventListener('click', stopSystem);
        document.getElementById('debugBtn').addEventListener('click', showDebugReport);
    </script>
</body>
</html>
